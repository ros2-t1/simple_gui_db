# 🔧 로봇 상태 디버그 도구

실제 로봇 없이 플릿 관리 시스템을 테스트할 수 있는 디버그 도구입니다.

## 📋 기능

### 1. 로봇 상태 제어
- **수동 상태 변경**: 로봇을 원하는 상태로 즉시 변경
- **작업 ID 할당**: 특정 작업을 로봇에 직접 할당
- **로봇 초기화**: 로봇을 idle 상태로 리셋

### 2. 작업 관리
- **테스트 작업 생성**: 배달/호출 작업 임의 생성
- **작업 상태 변경**: 작업을 완료/실패 처리
- **활성 작업 모니터링**: 현재 진행 중인 모든 작업 확인

### 3. 시나리오 시뮬레이션
- **픽업 시뮬레이션**: 아이템 픽업 전체 과정
- **배달 시뮬레이션**: 완전한 배달 워크플로우
- **호출 시뮬레이션**: 로봇 호출 시나리오
- **다중 로봇 테스트**: 여러 로봇 동시 작업

## 🚀 사용 방법

### 1. 디버그 모드 실행 (추천)
```bash
# 웹 서버만 실행하여 순수 디버깅
python run_debug_mode.py
```

### 2. 전체 시스템 실행
```bash
# Fleet Manager + 웹 서버 모두 실행
python run_fleet.py
```

### 3. 디버그 인터페이스 접속
브라우저에서 다음 주소로 접속:
```
http://localhost:8080/robot_debug
```

## 🎮 사용 시나리오

### 배달 테스트
1. "배달 시나리오" 버튼 클릭 
2. 자동으로 테스트 작업 생성 및 로봇 출발
3. 픽업 → 배달 → 수령 확인 과정 시뮬레이션

### 호출 테스트  
1. "호출 시나리오" 버튼 클릭
2. 로봇이 사용자 위치로 이동
3. 도착 후 수령 대기 상태

### 수동 테스트
1. 원하는 로봇 선택
2. 상태 드롭다운에서 상태 변경
3. "상태 업데이트" 클릭
4. 웹 대시보드에서 변화 확인

## 📊 모니터링

### 실시간 상태 확인
- 로봇 카드: 각 로봇의 현재 상태와 작업
- 작업 목록: 활성 작업들의 진행 상황  
- 디버그 로그: 모든 변경 사항 기록

### 관련 엔드포인트
```
GET  /robot_debug              # 디버그 인터페이스
GET  /robot_status             # 전체 로봇 상태
GET  /debug/active_tasks       # 활성 작업 목록
POST /debug/robot_status/<id>  # 로봇 상태 변경
POST /debug/create_test_task   # 테스트 작업 생성
```

## 🧪 자동 테스트

API 엔드포인트 테스트:
```bash
python test_debug_tool.py
```

## 🔄 로봇 상태 설명

| 상태 | 설명 | 사용 시점 |
|------|------|-----------|
| `idle` | 대기 상태 | 작업 없을 때 |
| `moving_to_arm` | 아이템으로 이동 | 픽업 시작 |
| `picking` | 아이템 집는 중 | 픽업 진행 |
| `moving_to_user` | 사용자로 이동 | 배달 시작 |
| `waiting_confirm` | 수령 대기 | 도착 완료 |
| `returning_to_dock` | 도킹 복귀 | 작업 완료 후 |
| `error` | 오류 상태 | 문제 발생 시 |

## 💡 팁

### 웹 대시보드 연동 테스트
1. 디버그 도구에서 로봇을 `waiting_confirm` 상태로 설정
2. 주민 ID 9999로 로그인: `http://localhost:8080/?resident_id=9999`
3. 메인 대시보드에서 확인 버튼이 나타나는지 확인

### 다중 로봇 테스트
1. "다중 로봇 테스트" 버튼으로 여러 작업 생성
2. 각 로봇이 독립적으로 작업 수행하는지 확인
3. 작업 간 충돌이 없는지 모니터링

### 에러 상황 테스트
1. 로봇을 `error` 상태로 설정
2. Fleet Manager가 다른 로봇에 작업 재할당하는지 확인
3. 복구 시나리오 테스트

이 도구를 사용하면 실제 로봇 하드웨어 없이도 전체 플릿 시스템의 로직을 완전히 테스트할 수 있습니다.